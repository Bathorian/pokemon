<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Pokémon Lookup (Vue)</title>
  <style>
    /* Dark theme styles */
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; padding: 20px; background: #0b1220; color: #e5e7eb; }
    .container { max-width: 900px; margin: 0 auto; }
    h1 { font-size: 1.6rem; margin-bottom: 1rem; }
    .search { display: flex; gap: 8px; margin-bottom: 1rem; flex-wrap: wrap; }
    input[type="text"], select { flex: 1; min-width: 220px; padding: 10px 12px; font-size: 1rem; border: 1px solid #374151; border-radius: 8px; background: #111827; color: #e5e7eb; }
    button { padding: 10px 14px; border: 0; background: #2563eb; color: white; border-radius: 8px; cursor: pointer; font-weight: 600; }
    button:disabled { background: #334155; cursor: not-allowed; }
    .card { background: #111827; border: 1px solid #1f2937; border-radius: 12px; padding: 16px; box-shadow: 0 2px 8px rgba(0,0,0,0.35); }
    .row { display: flex; gap: 16px; flex-wrap: wrap; align-items: flex-start; }
    .media { width: 160px; text-align: center; }
    .media img { width: 120px; height: 120px; image-rendering: pixelated; }
    .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 12px; }
    .pill { display: inline-block; padding: 2px 8px; border-radius: 999px; background: #1e293b; color: #c7d2fe; font-size: 0.85rem; margin-right: 6px; }
    .muted { color: #94a3b8; font-size: 0.95rem; }
    .error { background: #3f1d1d; color: #fecaca; border: 1px solid #7f1d1d; padding: 10px 12px; border-radius: 8px; }
    .section-title { font-weight: 700; margin-top: 12px; margin-bottom: 6px; }
    a { color: #60a5fa; text-decoration: none; }
    /* Custom dropdown for Pokémon with inline sprites */
    .dropdown { position: relative; flex: 1; min-width: 260px; }
    .dropdown-toggle { width: 100%; text-align: left; padding: 10px 12px; font-size: 1rem; border: 1px solid #374151; border-radius: 8px; background: #111827; color: #e5e7eb; display: flex; align-items: center; gap: 8px; }
    .dropdown-toggle img { width: 28px; height: 28px; image-rendering: pixelated; }
    .dropdown-menu { position: absolute; z-index: 10; background: #0f172a; border: 1px solid #1f2937; border-radius: 8px; width: 100%; max-height: 300px; overflow: auto; margin-top: 6px; box-shadow: 0 10px 24px rgba(0,0,0,0.45); }
    .dropdown-item { display: flex; align-items: center; gap: 8px; padding: 8px 10px; cursor: pointer; color: #e5e7eb; }
    .dropdown-item img { width: 28px; height: 28px; image-rendering: pixelated; }
    .dropdown-item:hover { background: #1f2937; }
  </style>
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
</head>
<body>
  <div id="app" class="container">
    <h1>Pokémon Lookup</h1>
    <div class="search">
      <select v-model="selectedGen" @change="loadSpecies" :disabled="loading || generations.length === 0" aria-label="Generation selector">
        <option value="" disabled>Select generation…</option>
        <option v-for="g in generations" :key="g.id" :value="g.id">Generation {{ g.id }} — {{ g.name }}</option>
      </select>

      <!-- Custom Pokémon dropdown with sprite icons -->
      <div class="dropdown" :aria-disabled="loading || species.length === 0">
        <button type="button" class="dropdown-toggle" @click="toggleSpeciesList" :disabled="loading || species.length === 0" aria-haspopup="listbox" :aria-expanded="speciesOpen">
          <template v-if="selectedPokemon">
            <img :src="selectedPokemon.sprite" :alt="selectedPokemon.name + ' sprite'" />
            <span style="text-transform: capitalize;">{{ selectedPokemon.name }}</span>
          </template>
          <template v-else>
            <span class="muted">Select a Pokémon…</span>
          </template>
        </button>
        <div v-if="speciesOpen" class="dropdown-menu" role="listbox">
          <div class="dropdown-item" v-for="item in species" :key="item.id + '-' + item.name" role="option" @click="chooseSpecies(item)">
            <img :src="item.sprite" :alt="item.name + ' sprite'" />
            <span style="text-transform: capitalize;">{{ item.name }}</span>
          </div>
        </div>
      </div>

      <button @click="search" :disabled="loading || !selectedPokemon">{{ loading ? 'Loading…' : 'Load' }}</button>
    </div>

    <div v-if="error" class="error" role="alert">{{ error }}</div>

    <div v-if="pokemon" class="card">
      <div class="row">
        <div class="media" v-if="primarySprite">
          <img :src="primarySprite" :alt="`Sprite of ${pokemon.name}`" />
          <div class="muted">Sprite</div>
        </div>
        <div style="flex:1; min-width: 240px;">
          <div class="section-title" style="margin-top:0;">Summary</div>
          <div class="grid">
            <div><strong>Name:</strong> {{ pokemon.name }}</div>
            <div><strong>ID:</strong> {{ pokemon.id }}</div>
            <div><strong>Height:</strong> {{ pokemon.height }}</div>
            <div><strong>Weight:</strong> {{ pokemon.weight }}</div>
            <div v-if="pokemon.base_experience != null"><strong>Base XP:</strong> {{ pokemon.base_experience }}</div>
            <div v-if="pokemon.order != null"><strong>Order:</strong> {{ pokemon.order }}</div>
            <div v-if="pokemon.is_default != null"><strong>Is default:</strong> {{ pokemon.is_default }}</div>
          </div>

          <div class="section-title">Types</div>
          <div v-if="types.length">
            <span v-for="t in types" :key="t.slot" class="pill">[{{ t.slot }}] {{ t.name }}</span>
          </div>
          <div v-else class="muted">n/a</div>

          <div class="section-title">Abilities</div>
          <div v-if="abilities.length">
            <div v-for="a in abilities" :key="a.key">{{ a.name }} <span class="muted">(hidden={{ a.hidden }}, slot={{ a.slot }})</span></div>
          </div>
          <div v-else class="muted">n/a</div>

          <div class="section-title">Base stats</div>
          <div class="grid">
            <div v-for="s in stats" :key="s.name"><strong>{{ s.name }}:</strong> {{ s.value }}</div>
          </div>

          <div class="section-title" v-if="pokemon.held_items && pokemon.held_items.length">Held items</div>
          <div v-if="pokemon.held_items && pokemon.held_items.length" class="grid">
            <div v-for="hi in pokemon.held_items" :key="hi.item.name">{{ hi.item.name }}</div>
          </div>

          <div class="section-title" v-if="pokemon.forms && pokemon.forms.length">Forms</div>
          <div v-if="pokemon.forms && pokemon.forms.length" class="grid">
            <div v-for="f in pokemon.forms" :key="f.name">{{ f.name }}</div>
          </div>

          <div class="section-title" v-if="pokemon.species">Species</div>
          <div v-if="pokemon.species" class="muted">
            <span v-if="pokemon.species.name">{{ pokemon.species.name }}</span>
            <span v-if="pokemon.species.url"> — <a :href="pokemon.species.url" target="_blank" rel="noreferrer noopener">API</a></span>
          </div>

          <div class="section-title" v-if="pokemon.location_area_encounters">Encounters</div>
          <div v-if="pokemon.location_area_encounters" class="muted">
            <a :href="pokemon.location_area_encounters" target="_blank" rel="noreferrer noopener">View encounter locations</a>
          </div>

          <div class="section-title" v-if="cries.latest || cries.legacy">Cries</div>
          <div v-if="cries.latest || cries.legacy" class="grid">
            <div v-if="cries.latest"><a :href="cries.latest" target="_blank" rel="noreferrer noopener">Latest</a></div>
            <div v-if="cries.legacy"><a :href="cries.legacy" target="_blank" rel="noreferrer noopener">Legacy</a></div>
          </div>
        </div>
      </div>
    </div>

    <p class="muted" style="margin-top:16px;">Data from <a href="https://pokeapi.co/" target="_blank" rel="noreferrer noopener">PokeAPI</a>. This is a static page using Vue 3 from CDN.</p>
  </div>

  <script>
    const { createApp, ref, computed, onMounted } = Vue;
    createApp({
      setup() {
        // selectors state
        const generations = ref([]); // [{id, name, url}]
        const selectedGen = ref("");
        const species = ref([]); // [{id, name, sprite}]
        const selectedPokemon = ref(null); // {id, name, sprite}
        const speciesOpen = ref(false);

        const loading = ref(false);
        const error = ref("");
        const pokemon = ref(null);

        const API_BASE = "https://pokeapi.co/api/v2/pokemon/";
        const GENERATION_LIST = "https://pokeapi.co/api/v2/generation?limit=100";
        const GENERATION_DETAIL = (id) => `https://pokeapi.co/api/v2/generation/${id}`;

        const primarySprite = computed(() => pokemon.value?.sprites?.front_default || "");
        const types = computed(() => (pokemon.value?.types || []).map(t => ({ slot: t.slot, name: t.type?.name })));
        const abilities = computed(() => (pokemon.value?.abilities || []).map(a => ({
          key: `${a.ability?.name}-${a.slot}-${a.is_hidden}`,
          name: a.ability?.name,
          hidden: a.is_hidden,
          slot: a.slot
        })));
        const stats = computed(() => (pokemon.value?.stats || []).map(s => ({
          name: s.stat?.name,
          value: s.base_stat
        })));
        const cries = computed(() => pokemon.value?.cries || {});

        async function loadGenerations() {
          try {
            error.value = "";
            const resp = await fetch(GENERATION_LIST);
            const data = await resp.json();
            const gens = (data.results || []).map((r) => {
              const m = (r.url || "").match(/\/(\d+)\/?$/);
              const id = m ? Number(m[1]) : r.name;
              return { id, name: r.name, url: r.url };
            }).sort((a,b) => (a.id > b.id ? 1 : -1));
            generations.value = gens;
          } catch (e) {
            error.value = e?.message || String(e);
          }
        }

        async function loadSpecies() {
          species.value = [];
          selectedPokemon.value = null;
          speciesOpen.value = false;
          pokemon.value = null;
          if (!selectedGen.value) return;
          loading.value = true;
          error.value = "";
          try {
            const resp = await fetch(GENERATION_DETAIL(selectedGen.value));
            if (!resp.ok) throw new Error(`Failed to load generation ${selectedGen.value} (${resp.status})`);
            const data = await resp.json();
            const list = (data.pokemon_species || [])
              .map(s => {
                const name = s.name;
                // Extract numeric id from species URL
                const m = (s.url || "").match(/\/(\d+)\/?$/);
                const id = m ? Number(m[1]) : null;
                // Build sprite URL using the numeric id when available
                const sprite = id ? `https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/${id}.png` : "";
                return { id: id ?? name, name, sprite };
              })
              .filter(item => !!item.name)
              .sort((a, b) => a.name.localeCompare(b.name));
            species.value = list;
          } catch (e) {
            error.value = e?.message || String(e);
          } finally {
            loading.value = false;
          }
        }

        function toggleSpeciesList() {
          if (loading.value || species.value.length === 0) return;
          speciesOpen.value = !speciesOpen.value;
        }

        function chooseSpecies(item) {
          selectedPokemon.value = item;
          speciesOpen.value = false;
        }

        async function search() {
          error.value = "";
          pokemon.value = null;
          const q = (selectedPokemon.value?.name || "").trim().toLowerCase();
          if (!q) {
            error.value = "Please select a Pokémon.";
            return;
          }
          loading.value = true;
          try {
            const resp = await fetch(API_BASE + encodeURIComponent(q));
            if (resp.status === 404) {
              throw new Error(`Pokémon "${q}" not found (404).`);
            }
            const data = await resp.json();
            pokemon.value = data;
          } catch (e) {
            error.value = e?.message || String(e);
          } finally {
            loading.value = false;
          }
        }

        onMounted(loadGenerations);

        return { generations, selectedGen, species, selectedPokemon, speciesOpen, loading, error, pokemon, search, loadSpecies, toggleSpeciesList, chooseSpecies, primarySprite, types, abilities, stats, cries };
      }
    }).mount('#app');
  </script>
</body>
</html>
